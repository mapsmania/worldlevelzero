<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>World Map Projections</title>
<style>
  body { background:#111; color:#fff; font-family: sans-serif; margin:0; }
  header { padding:10px; text-align:center; }
  header span { margin:0 12px; cursor:pointer; color:#ccc; font-weight:bold; }
  header span.active { color:#4CAF50; }
  svg { display:block; margin:auto; }
  .label {
    font-size:22px;
    font-weight:600;
    fill:#fff;
    text-anchor:middle;
  }
</style>
</head>
<body>
<header id="proj-header">
  <span data-proj="mercator" class="active">Mercator</span> -
  <span data-proj="mollweide">Mollweide</span> -
  <span data-proj="robinson">Robinson</span> -
  <span data-proj="orthographic">Orthographic</span>
</header>

<svg id="map" width="960" height="520"></svg>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/topojson-client@3"></script>
<script src="https://unpkg.com/d3-geo-projection@4"></script>

<script>
(async function(){
  const width = 960, height = 520;
  const svg = d3.select("#map");
  const g = svg.append("g");
  const label = svg.append("text")
    .attr("class","label")
    .attr("x", width/2)
    .attr("y", height-20);

  const path = d3.geoPath();

  const projections = ["mercator", "mollweide", "robinson", "orthographic"];
  let currentIndex = 0;

  function makeProjection(name){
    const s = 150, c = [width/2, height/2];
    switch(name){
      case "mercator": return d3.geoMercator().scale(s).translate(c);
      case "mollweide": return d3.geoMollweide().scale(s).translate(c);
      case "robinson": return d3.geoRobinson().scale(s).translate(c);
      case "orthographic": return d3.geoOrthographic().scale(200).translate(c).clipAngle(90);
      default: return d3.geoMercator().scale(s).translate(c);
    }
  }

  const topo = await d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json");
  const countries = topojson.feature(topo, topo.objects.countries).features;

  // Draw countries once
  g.selectAll("path").data(countries).join("path")
    .attr("fill","#4CAF50")
    .attr("stroke","#111")
    .attr("stroke-width",0.4);

  function updateProjection(projName){
    const proj = makeProjection(projName);
    path.projection(proj);
    g.selectAll("path").transition().duration(1000).attr("d", path);
    label.text(projName[0].toUpperCase() + projName.slice(1));
    d3.selectAll("#proj-header span").each(function(){
      this.classList.toggle("active", this.dataset.proj === projName);
    });
  }

  function nextProjection(){
    currentIndex = (currentIndex + 1) % projections.length;
    updateProjection(projections[currentIndex]);
  }

  // Header click handlers
  d3.selectAll("#proj-header span").on("click", function(){
    const projName = this.dataset.proj;
    currentIndex = projections.indexOf(projName);
    updateProjection(projName);
  });

  // Initial projection
  updateProjection(projections[currentIndex]);

  // Looping animation: advance every 2.5s
  d3.interval(()=>{
    nextProjection();
  }, 2500);

})();
</script>

</body>
</html>
