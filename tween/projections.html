<!DOCTYPE html>
<meta charset="utf-8">
<style>
  body { background:#111;margin:0;overflow:hidden; }
  svg  { display:block;margin:auto; }
</style>
<body>
<svg width="960" height="500"></svg>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/topojson-client@3"></script>
<script src="https://unpkg.com/d3-geo-projection@4"></script>
<script>
const width = 960, height = 500;
const svg = d3.select("svg");
// We define path without a projection initially, as it will be set in the loop
const path = d3.geoPath(); 

d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then(world => {
  const countries = topojson.feature(world, world.objects.countries).features;

  const g = svg.append("g")
    .attr("fill", "#4CAF50")
    .attr("stroke", "#222")
    .selectAll("path")
    .data(countries)
    .join("path");

  // Define interpolators outside the loop for efficiency
  // This will interpolate the scale (zoom) from 100 to 250
  const scaleInterp = d3.interpolate(100, 250); 
  // This will interpolate the rotation (spin) from -20 degrees (Atlantic-centric) to -180 degrees (Pacific-centric)
  const rotateInterp = d3.interpolate([-20, 0], [-180, 0]); 

  let t = 0, dir = 1;
  
  function frame(){
    t += dir * 0.01;
    // Reverse direction at the limits [0, 1]
    if(t >= 1){t = 1; dir = -1;}
    if(t <= 0){t = 0; dir = 1;}

    // âœ… CORRECTION: Use a single stable projection type (e.g., Mercator)
    // and animate its configuration parameters.
    const proj = d3.geoMercator()
      .scale(scaleInterp(t))
      .rotate(rotateInterp(t))
      .translate([width/2, height/2]);

    // Apply the new projection to the path generator
    path.projection(proj);
    
    // Update the 'd' attribute of the paths
    g.attr("d", d => path(d));
  }

  // run at ~20fps (every 50ms)
  d3.interval(frame, 50);
});
</script>
</body>
</html>
